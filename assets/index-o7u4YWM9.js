import{b as a,_ as u}from"./preact.module-0A_VdQ5M.js";import{u as c,m as d}from"./styled-components.browser.esm-LOVPg310.js";import{P as m}from"./index-YL57stmL.js";c.img.attrs(e=>({src:e.src,OnLoad:e.OnLoad}))`
    opacity: ${({loaded:e})=>e?1:0};
    transition: opacity 300ms;
`;const n={};function i(e){return n[e]||f(e),n[e]}function f(e){n[e]={queued:[],waitTime:50,observer:new IntersectionObserver(t=>{t.forEach(s=>{s.isIntersecting&&l(s.target,e)})})}}function h(e,t){const s=new Promise(o=>{i(t).queued.push({loadRef:e,resolve:o,visible:!1})});return i(t).observer.observe(e.current.base),s}function l(e,t){i(t).observer.unobserve(e);const s=i(t).queued.find(o=>o.loadRef.current.base===e);s!==void 0&&s.resolve()}function r(e,t){i(t).queued=i(t).queued.filter(s=>s.loadRef!==e)}class G extends a{constructor(t){super(t),this.state={src:"",loadGroup:"default"},this.elmRef=u()}componentDidMount(){this.componentDidUpdate({})}componentDidUpdate(t={}){t.src!==this.props.src&&this.loadMe()}loadMe(){r(this.elmRef,this.state.loadGroup),h(this.elmRef,this.state.loadGroup).then(()=>{this.img=new Image,this.img.onload=()=>{this.setState({...this.state,src:this.props.src}),r(this.elmRef,this.state.loadGroup)},this.img.src=this.props.src})}componentWillUnmount(){r(this.elmRef,this.state.loadGroup)}render(){return d`<${m} ref=${this.elmRef} img=${this.img} src=${this.state.src} />`}}export{G as L};
